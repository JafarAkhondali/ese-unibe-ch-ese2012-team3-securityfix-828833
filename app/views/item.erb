<% @title = "Item: #{@item.name}" %>

<section id="content" xmlns="http://www.w3.org/1999/html">
  <div class="row">
    <%= erb :_sidebar %>

    <div class="span10">
      <h1>Item: <%= xss @item.name %></h1>

      <table style="width:400px"><tr><%= erb :_item_button, :locals => {:item => @item, :current_user => @current_agent} %></tr></table>

      <%= erb :_image_rect, :locals => {:filename => @item.image_file_name, :size => LARGEIMAGESIZE} %>

      <table class="table table-bordered" style="width: 66%">
        <tr>
          <td>Owner:</td>
          <td><%= erb :_user_link, :locals => {:user => @item.owner} %></td>
        </tr>
        <tr>
          <td>Price</td>
          <td><%= xss ts(@item.price) %></td>
        </tr>
        <tr>
          <td>Description:</td>
          <td><%= mdown_to_html(xss @item.about) %></td>
        </tr>
      </table>


      <h3>Comments</h3>
      <%if @item.comments.length == 0%>
        This item has no comments yet.
      <%else%>
          <table class="table table-striped" style="width: 66%">
            <%for comment in @item.comments.reverse%>
            <tr>
              <td> <%= erb :_user_link, :locals => {:user => comment.creator} %>
                <%if comment.creator == @item.owner %>
                <span class="label label-success">Owner</span>
                <%end%>
              </td>
              <td> <%= mdown_to_html(xss comment.text) %> </td>
              <td>
                <form action="#" method="POST">
                  <input type="hidden" name="creator" value="<%= xss comment.creator %>" />
                  <input type="hidden" name="quote" value="<%= xss comment.text %>" />
                  <button class="btn btn-info small" name="reply"
                      onClick="document.getElementById('newCommentArea').value='<%= xss comment.creator.name; %> wrote:\n > <%= xss comment.text.tr("\r\n", " ") %>'; return false;">Reply</button>
                </form>
              </td>
            </tr>
            <%end%>
          </table>
      <%end%>

      <h2>Add comment</h2>
      <p>You can use markdown syntax to style the comment. For example: **<b>bold text</b>**</p>
      <form action="/item/<%= @item.id.to_s %>/add_comment" method="POST">
        <input type="hidden" name="commenter" value="<%= @current_agent %>" />
        <textarea id="newCommentArea" class="field span7" name="comment"
            placeholder="Add some comment, maybe?" rows="7"></textarea><br />
        <input type="submit" class="btn btn-info" name="submit" value="Add comment" />
      </form>
    </div>
  </div>
</section>
