<% @title = "Auction" %>

<section id="content" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
  <div class="row">
    <%= erb :_sidebar %>
    <div class="span10">
      <h2>Auction for <%= xss item.name %></h2>
      <%= erb :_image_rect, :locals => {:filename => item.image_file_name, :size => LARGEIMAGESIZE} %>
      </br>
      <table class="table">
        <tbody>
          <tr>
            <td>Description</td>
            <td><%= mdown_to_html(xss item.about) %></td>
          </tr>
          <tr>
            <td>Start price:</td>
            <td><%= item.auction.minimal_price %></td>
          </tr>
          <tr>
            <td>Current price:</td>
            <td><%= (item.auction.current_price.nil?) ? "-" : item.auction.current_price %>
          </tr>
          <tr>
            <td>Minimal bid increment:</td>
            <td><%= item.auction.increment %></td>
          </tr>
          <tr>
            <td>Current winner</td>
            <td><%= (item.auction.winner.nil?) ? "-" : item.auction.winner %></td>
          </tr>
        </tbody>
      </table>

      <style type="text/css">
          .past-winner {
              margin-bottom: 0.5em;
              padding-left: 15px;
          }

          .past-winner-name {
              font-weight: bold
          }

          #past-winner-title {
              padding-top: 2px;
              padding-bottom: 2px;
              padding-left: 10px;
              margin-bottom: 20px;
              margin-top: 20px;
              background-color: #f5f5f5;
              border: 1px solid #eee;
              border: 1px solid rgba(0, 0, 0, 0.05);
              -webkit-border-radius: 4px;
              -moz-border-radius: 4px;
              border-radius: 4px;
              -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
              -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
              box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
          }

          #past-winner-title .text {
           padding-left: 10px;
          }

          #past-winner-content {
              margin-top: -20px;
              margin-bottom: 20px;
          }
      </style>

      <script type="text/javascript">
          if (document.getElementById){
              document.write('<style type="text/css">\n')
              document.write('#past-winner-content{display: none;}\n')
              document.write('</style>\n')
          }

          function SwitchMenu(obj){
              if(document.getElementById){
                  var title = document.getElementById('past-winner-title')
                  var icon = title.getElementsByClassName('symbol')[0]
                  var text = title.getElementsByClassName('text')[0]
                  var content = document.getElementById(obj);
                  if(content.style.display != "block"){
                      content.style.display = "block";
                      icon.className = "symbol icon-chevron-up"
                      text.textContent = "Past winners"
                  }else{
                      content.style.display = "none";
                      icon.className = "symbol icon-chevron-down"
                      text.textContent = "Past winners (click to expand)"
                  }
              }
          }
      </script>

      <% if item.auction.past_winners.size > 0 %>
          <div id='past-winner-expandable'>
            <div id="past-winner-title" onclick="SwitchMenu('past-winner-content')">
              <i class="symbol icon-chevron-down"></i><span class="text">Past winners (click to expand)</span>
            </div>
            <div id="past-winner-content">
              <% item.auction.past_winners.each do |past_winner| %>
                  <div class="past-winner">
                    <span class='past-winner-name'><%= "#{past_winner.agent.name} made a bit on "  %></span>
                    <span class='past-winner-time'><%= "#{past_winner.time} for" %> </span>
                    <span class='past_winner-price'><%= "#{past_winner.price} credits" %> </span>
                  </div>
              <% end %>
            </div>
          </div>
      <% end %>

      <form class="form-horizontal" method="POST" action="<%="/item/#{item.id}/bid" %>" enctype="multipart/form-data" style="margin-top: 5px;">
        <fieldset>
          <%= erb :_text_control, :locals => {:name => :bid, :label => "Your bid" }%>

          <div class="form-actions">
            <button class="btn btn-info" type="submit">Save</button>
          </div>
        </fieldset>
      </form>

    </div>
    </div>
  </div>
</section>

