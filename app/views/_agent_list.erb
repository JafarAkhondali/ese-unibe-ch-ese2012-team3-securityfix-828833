<% # Parameters (to pass in :locals)
# * agents to display
# * version: Optional - any of the identifiers
#   :leave_organization Supply when listing orgs a user has joined, must also supply user then
#   :remove_org_member Supply when listing org members, must supply org
#   or nil
# :identifier - identifier for this list on a page with multiple item lists, used for paging links
identifier = :agentlistpage unless identifier
page = params[identifier] ? params[identifier].to_i : 0
%>

<%= erb :_pages_links, :locals => {:cur_page => page,
                                   :size => agents.size,
                                   :per_page => AGENTS_PER_PAGE,
                                   :identifier => identifier}
%>

<table class="table">
  <thead>
  <th>Picture</th>
  <th>Name</th>
  <th>About</th>
  <th></th>
  <th></th>
  <th></th>
  </thead>
  <tbody>
  <% agents.each_with_index do |agent, index| %>
      <% next unless index/AGENTS_PER_PAGE == page %>
      <tr style="height:<%= LISTROWWITHIMAGEHEIGHT%>px">
        <td><%= erb :_image_rect, :locals => {:filename => agent.image_file_name, :size => LISTIMAGESIZE} %></td>
        <td><%= erb :_user_link, :locals => {:user => agent} %></td>
        <td><%= mdown_to_html (xss agent.about) %></td>
        <td></td>
        <td></td>
        <td>
          <% if defined? version%>
            <%if version == :leave_organization %>

                <%if agent.admin != @current_user # If the currently logged in person is admin of the org, he can't leave it
          %>
                  <form action="/organization/<%= xss agent.id %>/remove_member" method="post">
                    <input type="hidden" name="user_to_remove" value="<%= xss user.id%>" />
                    <input type="submit" class="btn btn-info small" name="submit" title="Leave Organization" value="Leave it!" />
                  </form>
            <%  end %>
            <% end

               if version == :remove_org_member%>
               <%if agent != org.admin # the admin cannot be removed %>

                      <form action="/organization/<%= xss org.id %>/remove_member" method="post" style="display: inline;">
                        <input type="hidden" name="user_to_remove" value="<%= xss agent.id %>" />
                        <button class="close" title="Remove member">&times;</button>
                      </form>
               <%end%>
              <%end%>

             <%end # if version?%>
        </td>

      </tr>
  <% end %>
  </tbody>
</table>