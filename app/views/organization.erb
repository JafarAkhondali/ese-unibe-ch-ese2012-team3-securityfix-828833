<% @title = "Organization: #{@org.name}" %>

<section id="content">
  <div class="row">
    <%= erb :_sidebar %>
    <div class="span10">
      <h1>Organization: <%= xss @org.name %></h1>

      <% if @user != @current_user && @current_user == @current_agent%>
          <form action="/follow" method="POST">
            <input type="hidden" name="follow_id" value="<%= xss @org.id%>" />
            <input type="hidden" name="agent" value="org" />
            <% if @current_user.following.include?(@org) %>
                <input type="submit" class="btn btn-danger small" name="submit" value="Unfollow" />
            <%else%>
                <input type="submit" class="btn btn-info small" name="submit" value="Follow" />
            <%end%>
          </form>
      <%end%>

      <%= erb :_image_rect, :locals => {:filename => @org.image_file_name, :size => LARGEIMAGESIZE} %>

      <% if !@org.about.empty? %>
          <p>About: <%= mdown_to_html (xss @org.about) %></p>
      <% end %>

      <% if @current_agent == @org %>
          <h3 style="padding-top: 50px;">Latest Organization Activities</h3>

          <% testactivities=[]     # TODO use @org.orgactivities, sorted in reverse (that is, by time, most recent first)
             for i in 0...2
               testactivities.push(Activity.init(:creator => JACK_USER, :message => "#{i} bought the item 'pizza' for 123 credits", :type => :buy))
               testactivities.push(Activity.init(:creator => JACK_USER, :message => "#{i} created the item 'pizza'", :type => :createitem))
               testactivities.push(Activity.init(:creator => JACK_USER, :message => "#{i} commented on 'pizza'", :type => :comment))
             end
          %>

          <%=erb :_activity_list, :locals=>{
                  :activities => testactivities
          }%>
      <%end%>

      <h3 style="padding-top: 50px;"><%= xss @org.name %>'s Items</h3>
      <% if @items.size > 0 %>

          <%=erb :_item_list, :locals=>{
                  :items => @items,
                  :highlight_active => true
          }%>

      <% else %>
        <i>This organization has no items.</i>
      <% end %>

      <% if @org == @current_agent %>
          <form class="form-horizontal" method="GET" action="/item/create">
            <fieldset>
              <div class="form-actions">
                <button class="btn btn-info" type="submit">Add a new item...</button>
              </div>
            </fieldset>
          </form>
      <% end %>
    </div>
  </div>
</section>


