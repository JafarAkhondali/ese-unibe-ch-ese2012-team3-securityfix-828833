<% #Buy/activate/deactivate buttons

   if item.active %>
    <%if item.owner == @current_agent %>
        <td>
          <form action="/item/<%= item.id %>/status_change" method="post">
            <input type="hidden" name="owner" value="<%= xss item.owner.name %>" />
            <input type="hidden" name="item" value="<%= xss item.id %>" />
            <input type="hidden" name="new_state" value="inactive" />
            <button type="submit" class="btn btn-info small">Inactivate item</button>
          </form>
        </td>
    <% else %>
        <%if item.auction?%>
            <td>
              <form action="/item/<%= item.id %>/auction" method="GET">
                <input type="hidden" name="owner" value="<%= xss item.owner.name %>" />
                <input type="hidden" name="item" value="<%= xss item.id %>" />
                <button type="submit" class="btn btn-info small">Bid on auction</button>
              </form>
            </td>
        <%else%>
            <td>
              <form action="/item/<%= item.id %>/buy" method="post">
                <input type="hidden" name="owner" value="<%= xss item.owner.name %>" />
                <input type="hidden" name="item" value="<%= xss item.id %>" />
                <button type="submit" class="btn btn-info small" <%if @current_agent.credit < item.price%> disabled="disabled"<%end%>>Buy Item</button>
              </form>
            </td>
        <%end%>
        <td></td>
    <% end %>
<% else %>
    <%if item.owner == @current_agent %>
        <td>
          <form action="/item/<%= item.id %>/status_change" method="post">
            <input type="hidden" name="owner" value="<%= xss item.owner.name %>" />
            <input type="hidden" name="item" value="<%= xss item.id %>" />
            <input type="hidden" name="new_state" value="active" />
            <button type="submit" class="btn btn-info small" name="submit">Activate item</button>
          </form>
        </td>
    <% else %>
        <td style="color:#FF0000;">Inactive</td>
    <% end %>
<% end %>

<%  #params: item - the item to show the buttons for (output in two <td> s)

    # TODO we really don't need to pass current_user to this...

    #Edit button %>

<%if item.owner == @current_agent %>

    <%if item.active %>
        <% if item.auction? %>
            <% if !item.auction.editable? %>
                <td><%= @current_agent == item.owner ? "<i class='muted'>No longer editable after first bid</i>": ""%></td>
            <% else %>
                <td>
                    <form action="/item/<%= item.id %>/auction/edit" method="GET">
                      <button type="submit" class="btn btn-info small">Edit Auction</button>
                    </form>
                </td>
            <% end %>
        <% else %>
            <td><%= @current_agent == item.owner ? "<i class='muted'>Cannot edit active items</i>": ""%></td>
        <% end %>
    <% else %>
        <td>
          <form action="/item/<%= item.id %>/edit" method="GET">
            <button type="submit" class="btn btn-info small">Edit item</button>
          </form>
        </td>
    <% end %>
<% else %>
    <td></td>
<% end %>

<%  # The auction button   %>

<%if item.owner == @current_agent %>

    <%if item.active %>
        <% if item.auction? %>
            <td><%= @current_agent == item.owner ? "<i class='muted'>Auction ends at #{item.auction.end_time}</i>": ""%></td>
        <% else %>
            <td><%= @current_agent == item.owner ? "<i class='muted'>Currently not in auction</i>": ""%></td>
        <% end %>
    <% else %>
        <td>
          <form action="/item/<%= item.id %>/create_auction" method="GET">
            <button type="submit" class="btn btn-info small">Create Auction</button>
          </form>
        </td>
    <% end %>
<% else %>
    <% if item.auction? %>
        <td><i class='muted'>Auction ends at <%=item.auction.end_time.to_s%></i></td>
    <% else %>
        <td></td>
    <% end %>
<% end %>
